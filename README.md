# 图博-数字孪生-学习案例 1

---

### 1. 如何使用

#### 1.1 clone 工程.

```bash
git clone https://gitee.com/turbo-works/tb-twin-01.git
```

然后新开一个分支, 名称随意, 后续代码通过 `pr`合并到 master 分支.

### 1.2 安装依赖并本地运行

> 这里我们使用`pnpm`作为包管理工具, 终端执行

```bash
pnpm install
```

安装依赖, 然后运行

```bash
pnpm dev
```

打开浏览器 访问 [http://localhost:5173/](http://localhost:5173/) 即可看到三维场景.

### 2 开发说明

#### 2.1 项目技术栈

> 主要使用 Typescript + React + BabylonJS
> 其中, 二维的 UI 使用 React 开发.
> 三维相关的则使用 BabylonJS.

#### 2.2 工程目录结构

静态资源放到 `public`文件夹下
源码在 `src`文件夹下, 包含 UI + 三维场景

### 3 Roadmap

> 我们的目标是, 使用 TS + React + BabylonJS 等等, 开发一个完成度比较高的数字孪生项目.
> 具体的项目需求暂时还未定, 前期我们先通过完成一个个小的任务功能, 来熟悉掌握 TS + React + BabylonJS

#### 3.1 熟悉 BabylonJS

##### 3.1.1 加载模型

- 加载 `public/models/aerobatic_plane.glb`文件, 读取模型内的动画列表
- 用 React 做一个下拉框(下拉框内容为飞机模型的动画列表)
- 可以通过切换下拉框, 指定三维场景中的飞机执行对应的动画

#### 3.1.2 相机交互

- 当用户鼠标悬浮到模型上时, 模型会做高亮展示(如覆盖一层红色), 当鼠标移开, 则恢复正常.
- 用户点击模型后, 相机会做动画过渡(转场动画)到模型附近, 此时模型位于屏幕中央, 自适应屏幕尺寸(不会溢出, 或者太小).
- 此时相机的目标为选中模型的中心, 鼠标左键拖动, 相机会围绕模型转动.

#### 3.1.3 灯光 & 阴影

- 先做一个灰白色的地面, 用于接受阴影
- 做一个平行光, 可以根据场景内导入的模型在地面上生成阴影
- 用 React 做一个滑块空间, 范围 0~180, 用以表示平行光的倾斜角度, 滑块滑动时, 平行光的方向会跟着实时调整, 可以用来模拟动态太阳光效果.

#### 3.1.4 熟悉 Inspector

> inspector 是 BJS(BabylonJS 简称) 提供的场景检查面板, 可以方便我们查看场景内的元素以及做一些操作.
> 具体细节可以看: [Inspector](https://doc.babylonjs.com/toolsAndResources/inspector)

#### 3.1.5 材质基础

- 了解一下 BJS 提供的材质及其效果.
- 了解一下着色器的基本工作原理, 可以参考 `Games101`, `TheBooksOfShader`.
- 尝试用 `ShaderMaterial`实现一个材质, 让正方形的的 `GroundMesh` 显示为一个圆(底色为白色, 从圆心开始向外, 不透明度逐渐递减为 0).
- 熟悉一下 `NodeMaterial`, 然后用`NodeMaterial`重新实现上面的地面材质.

#### 3.2 完整孪生项目开发(毕业设计)

> 接下来, 我们就动手完成一个完整的数字孪生类项目.
> 一个完整的项目, 考虑更多的是如何设计和组织业务的代码, 包括:

- UI(JSX), 又分为主体UI(app)和可复用的组件UI(Components).
- 数据状态的管理, 这里我们使用 Mobx + Mobx-key-stone, 结合react一起使用
- 孪生三维场景, BJS相关的代码

##### 3.2.1 熟悉Mobx状态管理

- 过一遍`Mobx` + `Mobx-Key-stone`的文档, 了解一下大致的功能边界

##### 3.2.2 毕业设计功能拆解

- 找一个觉得比较不错的案例, 然后仿照案例, 设计一下初步的视觉稿
- 梳理一下项目需要的数据结构, 拆解具体的分页数据模型(包含哪些属性, 参数等)
- 整体的UI & 数据结构拆解完之后, 可以把后续的具体开发拆解成很多细小的任务(每个任务1-2天), 然后做一个粗略的排期.

##### 3.2.3 毕业设计开发

> 根据上面做的设计, 逐步完成细节, 1-2天提交一下代码.
